# Escape From Dungeon
- BGM・効果音素材はすべて魔王魂さん( https://maou.audio )からお借りしています。

## YouTube プレイ動画
https://youtu.be/sdqMlVHUhMc

## <ゲーム説明>
- ダンジョン内を移動し、アイテムを拾ったり使ったりしながら敵を倒しゴールにたどり着いたらクリアです。
- 紫色の場所は通るとダメージを受けますが毒にはなりません。
- HPが０になるか、Limitが０になるとゲームオーバーです。HPは拾ったポーションで回復できます。
- 基本的に行き止まりには、回復イベント・アイテム・もしくは罠があります。
- 毒になる罠があり、毒状態では移動やバトルのターン中にダメージを受けます。毒消し草で解除できます。
- 毒状態は、自動では回復しません。バトル中は毒消しを持っていると自動で使います。
- 移動中はどんどん視界が狭まっていくので、拾った松明で明るくしましょう。
- 基本的に敵がドア替わりなので、敵シンボルに向かって移動すればいいでしょう。
- 途中で敵の弱点になる武器を拾えば、攻撃力がアップして楽になります。

## <操作法>
- マウスで各ボタンをクリックすることでも操作できますが、キー操作の方がスムーズです。

## <移動時>
- 上下左右キー：移動
- [P]キー：HP回復(ポーションの所持数があれば)
- [O]キー:毒状態回復(毒消し草の所持数があれば)
- [I]キー:明かりの範囲を広げる(松明の所持数があれば)

## <バトル中>
- 上：攻撃　敵の弱点武器を入手していた場合、攻撃力が3倍になります。
- 左：防御　防御は完全無敵ですが、バトル中でもLimitは減っていきます。
- 右：HP回復　ポーションの所持数があれば回復できます。
- 下：逃げる いつでも１００％逃げることができますが、敵をスルーは出来ません。

---
## <このプログラムの制作について>
- 職業訓練として約３か月間 (6/17 ～ 8/22) C＃を学び、その後C＃での自作プログラム発表作品として制作しました。
- Javaを過去に学んでおり全くの初学者ではありませんが、数年間Javaは全く触っていませんでした。
- 制作期間は 8/26 ～ 9/4 の1週間ほど、さらに1週間ほど自分の中で切りの良いところまで続けました。
- いろいろ調べながらの上、製作時間に余裕がないため、最低限ゲームとしての体裁が整っていることを目標に制作しました。
  
## <制作内容について>
- ダンジョンを探索しバトルはターン制コマンドにする事は、ダンジョンゲームが好きなこともありすぐ決定しました。
- マップ・敵モンスター・アイテム・イベントを CSVでデータを作成し読み込みをすることは、過去に趣味で勉強した事の経験から決め、
敵モンスター・アイテム・イベントのデータは、それぞれクラスに格納しディクショナリーに追加。
- マップにいろいろ仕掛けを盛り込む考えはありましたが、時間の余裕がなく現状のものになっています。

## <移動時の仕様>
- 移動時には入力した方向が移動可能であるかチェックし、移動後に移動先座標のイベントをチェックしイベントがあれば処理。
- 移動後にはリミットの値が減少し、リミットが０になるとゲームーオーバー。
- プレーヤーステータスが毒の状態でダメージを受ける、もしくはダメージ床を通りダメージを受け、HPが０になるとゲームオーバー。
- ポーションでHPを回復、毒消しで毒状態を回復することができる。
- プレイヤーの毒状態はトラップイベントのみで変化。
- ある間隔での移動毎に視界が狭くなっていきマップの見通しが悪くなる。松明を使用することで視界は回復することが出来る。
- ポーション・毒消し・松明アイテムの所持数があれば各アイテム毎に使用ラベルが表示され、使用可能になる。
- 毒消し・松明の使用は移動時のみ可能。

## <バトル仕様>
- バトル開始で入力をしばらく無効にし敵画像を表示、移動コマンドの表記をバトル時のものに変更。アイテム使用のラベルは非表示。
- １対１のターン制バトルでプレイヤーから攻撃。
- プレイヤーは４つのコマンド(ただし回復はポーションの所持数がある場合可能)から選択。
- 敵は攻撃するか、一定ターンで強力な攻撃(前のターンで予告動作メッセージ)。
- どちらかのHPが０になるかプレイヤーが逃げるコマンドを選択したらバトル終了。
- ターン終了時にプレイヤーが毒のステータスの場合は毒ダメージが発生し、毒消しを所持していれば自動で使用。
- ターン終了時にリミットが減り、リミットが０になるとゲームオーバー。
- 攻撃時のパラメータは単純に攻撃力のみを参照し、その分だけ相手のHPがマイナスされる。ただしプレイヤーが防御を選択していた時には完全無敵。
- 敵には弱点が設定されており、その属性に有効な武器をプレイヤーが所持していれば攻撃力が２倍、ある特定の武器を所持していれば攻撃力が３倍になる。

## <表示の構造>
- プレイヤーの表示はマップ中央固定(向きは四方向の画像を切り替え)、移動はマップの表示位置を変更。
- フォームアプリは機能拡張をしなければ、画像のアルファが親子関係の子でしか有効にならない仕様のため、照明効果優先で敵シンボルの表示はマップに直接描画。
- バトル時の敵の画像は割り切ってアルファ無しの画像。

```
├─ FadeForm　タイトル・ゲームクリア時に表示するフォーム、表示の際フェード。
|   ├─ Label　タイトル・ゲームクリアの文字列表示
|   ├─ Button　スタートボタン
|   ├─ Button　終了ボタン
|
├─ Form　メインフォーム
    ├─ Image　マップ描画用の親にしてマップの表示を制御
    |   ├─ Image　マップ描画用 敵シンボルはマップに直接描画
    |       ├─ Image　照明効果をアルファで重ねて描画
    |           ├─ Image　プレイヤー表示用
    |  
    ├─ Image　敵画像表示用
    |  
    ├─ Image　プレイヤーステータス・インベントリ表示用
    ├─ Label アイテム使用コマンドラベル(ポーション)
    ├─ Label アイテム使用コマンドラベル(毒消し)
    ├─ Label アイテム使用コマンドラベル(松明)
    |  
    ├─ Image　タイムリミット表示用
    ├─ Image　メッセージ表示用
    |  
    ├─ Label コマンド用ラベル(↑移動 or 攻撃)
    ├─ Label コマンド用ラベル(←移動 or 防御)
    ├─ Label コマンド用ラベル(↓移動 or 逃げる)
    ├─ Label コマンド用ラベル(→移動 or 回復)
```
## <マップの仕様>
- マップのデータは、移動判定用の配列とイベント用の配列２つに格納。イベントは通路でしか起きない仕様なので、移動判定用の配列の値は通行可(0)にする。
- プレイヤーの移動時、移動判定用の配列で移動可能か判別し、移動が可能ならばイベント用の配列の値をチェックして処理を分岐し、イベントがある場合イベントディクショナリーからデータを参照し処理。
- 移動判定用の配列は 数値に変換して格納、値1(＝壁)以外は通行可能。移動先が敵の場合、勝利時に敵イベントを削除・逃げた場合プレイヤーの位置を移動前に戻す。
- 敵のいる位置はマップ生成時に床画像の上に敵シンボルの描画を重ね、敵を倒した時点で描画を床画像で上書きし敵シンボルを消す仕様。

| ID | 変換値 | 説明 | 表示パーツ | 処理 |
|----|--------|------|----------|---------------|
| 00 | 0 | 通路 | 床 | 通行可 |
| 11 | 1 | 普通の壁 | 壁 | 通行不可 |
| 12 | 2 | すり抜け壁 | 壁 | 通行可、すり抜けはプレイヤー表示を消すことで表現 |
| XX | 3 | ダメージ床 | ダメージ床 | 通行可、プレイヤーダメージ処理 |
| SS | 0 | スタート地点 | 床 | 通行可、プレイヤーの初期位置を変更 |
| GG | 0 | ゴール地点 | 床 | 通行可、到達でゲームクリア |
| E0～E9 | 0 | 敵位置 | 床＋敵シンボル | 敵撃破で床を上書き描画して消す|

- 上記(SSまで)以外のIDは、イベント用配列にIDを格納。イベントがない地点の値は null。
- プレイヤー移動時に移動先地点の座標のID値をチェックし、EventType によって分岐処理。
- IDの1文字目がイベントの種類、2文字目によりメッセージ・ヒントの内容や敵の種類を変更。
- ヒント表示以外のイベントは、処理後に値を null にしてイベントを削除。
- イベントは通路でしか起きない仕様なので表示パーツは床で固定。

| ID(1文字目) | ID(2文字目) | イベント内容 |
|------------|-----------|-------------|
| M | 0～3 | メッセージを表示(一度表示したらイベント削除) |
| H | 0～9、A～K | ヒントを表示(何度でも表示) |
| I | 0～8 | アイテムを入手(一度きり) |
| E | 1～9 | 敵とのバトル(逃げることが可能、倒すまでは削除されない) |
| T | 0～3 | トラップイベント(一度きり) |
| L | 0～3 | 回復イベント(一度きり) |
| G | G | ゴール地点(ゲームクリア) |

<img width="600" height="945" alt="EFD_csv" src="https://github.com/user-attachments/assets/7330e05c-c9e4-4e01-9735-e38c44c139d3" />

<img width="913" height="767" alt="EFD_map1" src="https://github.com/user-attachments/assets/2846c482-e194-4e80-91b9-ce8c629ba9e1" />

- マップのCSVは LibreOffice を使用し、マクロでセルの色を変え視覚的にわかりやすくして編集を行いました。
<img width="551" height="667" alt="EFD_map1macro" src="https://github.com/user-attachments/assets/c6a38e6e-a4c6-4f0b-ab29-7aa4d4e26549" />
